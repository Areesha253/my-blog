AOS.init();var base_url="includes/functions.php",relative_url="../"+base_url,checkIsMobile=($(window).on("scroll",function(){50<$(this).scrollTop()?$(".my-navbar").addClass("is-scrolled"):$(".my-navbar").removeClass("is-scrolled")}),()=>$(window).width()<=576),showToastAlert=(!checkIsMobile()&&window.location.pathname.includes("search-blog")&&(window.location.href="index"),(t,e={})=>{Toastify({text:t,duration:e.duration||2e3,gravity:e.gravity||"top",position:e.position||"left",backgroundColor:e.backgroundColor||"green"}).showToast()}),blogTemplateForHomepage=t=>`
   <div class="post-preview">
 <a href="single-blog?id=${t.id}" class="post-head">
              <h2 class="post-title">${t.title}</h2>
              <h3 class="post-subtitle">${t.subtitle}</h3>
          </a>
          <p class="post-meta">
              Posted by <a href="javascript:void(0)" class="post-author">${t.author}</a> on ${new Date(t.created_at).toDateString()}
          </p>
          <hr class="my-4">
          </div>
  `,blogTemplateForSinglePost=t=>`
                      <div class="single-blog-heading" data-id="${t.id}">
        <h1 class="main-heading">${t.title}</h1>
        <p class="sub-heading">${t.subtitle||""}</p>
        <p class ="author-text">Posted by <span>${t.author}</span> on ${new Date(t.created_at).toDateString()}</p>
                  </div>
  `,blogTemplateForContent=t=>`
   <div class="post-body">${t.content}</div>
  `,blogTemplateForDashboard=t=>`
                
                        <div class="blog-card">
                                               <div class="content">
                                                   <h2 class="post-title">${t.title}</h2>
                                                    <h3 class="post-subtitle">${t.subtitle}</h3>
                                                   <p class="post-author">By ${t.author} on ${new Date(t.created_at).toDateString()}</p>
                                                   <div class="post-body">${t.content}</div>
                                                   <div class="actions">
                                                     <button class="edit-btn action-btn" data-id="${t.id}">
                                                     <i class="fas fa-pencil"></i>
                                                     Edit</button>
                                                     <button class="delete-btn action-btn" data-id="${t.id}">
                                                     <i class="fas fa-trash"></i>
                                                     Delete</button>
                                                   </div>
                                               </div>
                                           </div>
                   
  `,suggestionTemplate=t=>`
    <li class="suggestion-item" data-id="${t.id}">
      <a href="single-blog.php?id=${t.id}" class="suggestion-link">${t.title}</a>
    </li>
  `,loadBlogsForDashboard=async()=>{try{var t=await $.ajax({url:relative_url,method:"GET",data:{name:"get_all",scope:"user"},dataType:"json"});$(".spinner-border").hide(),"empty"===t.status?$(".blog-list").append('<p class="no-blogs">No Blog Found!</p>'):($(".blog-list").empty(),t.blogs.forEach(t=>{$(".blog-list").append(blogTemplateForDashboard(t))}))}catch(t){console.error("Error loading blogs:",t)}},loadBlogsForHomepage=async()=>{try{var t=await $.ajax({url:base_url,method:"GET",data:{name:"get_all",scope:"all"},dataType:"json"});$(".spinner-border").hide(),"empty"===t.status?$(".post-cards").append('<p class="text-muted">No Blogs Found!</p>'):($(".post-cards").empty(),t.blogs.forEach(t=>{$(".post-cards").append(blogTemplateForHomepage(t))}))}catch(t){console.error("Error loading blogs:",t)}},loadSingleBlog=async()=>{var t=new URLSearchParams(window.location.search).get("id");try{var e=await $.ajax({url:base_url,data:{id:t,name:"get_single_blog"},method:"GET",dataType:"json"});$(".single-blog").html(blogTemplateForSinglePost(e)),$(".content-body").html(blogTemplateForContent(e))}catch(t){console.error("Error loading blog:",t)}},checkForPath=t=>window.location.pathname.includes(t),disableButton=(checkForPath("dashboard")&&loadBlogsForDashboard(),checkForPath("index")&&loadBlogsForHomepage(),checkForPath("single-blog")&&loadSingleBlog(),t=>{$(t).prop("disabled",!0)}),enableButton=t=>{$(t).prop("disabled",!1)};$(".create-blog-form").on("submit",async function(t){t.preventDefault(),tinymce.triggerSave();t=$(this).serialize();disableButton(".create-blog-btn");try{var e=await $.ajax({url:relative_url,method:"POST",data:t+"&name=create_blog",dataType:"json"});"success"===e.status?(showToastAlert("Blog posted successfully!"),window.location.href="dashboard"):alert("Error: "+e.message)}catch(t){console.error("Error creating blog:",t)}enableButton(".create-blog-btn")}),$(".blog-list").on("click",".delete-btn",async function(){var t=$(this).data("id"),e=$(this).closest(".blog-card");disableButton(this);try{"success"===(await $.ajax({url:relative_url,method:"DELETE",contentType:"application/json",data:JSON.stringify({id:t}),dataType:"json"})).status&&(e.fadeOut(function(){$(this).remove()}),showToastAlert("Blog deleted successfully!"))}catch(t){console.error("AJAX Error:",t),showToastAlert("Couldn't Delete Blog",{backgroundColor:"red"})}}),$("#user-login-form").on("submit",async function(t){t.preventDefault();var t=$("#identifier").val(),e=$("#password").val();try{var a=await $.ajax({type:"POST",url:base_url,data:{name:"user_login",identifier:t,password:e}});"success"===a.status?window.location.href="admin/dashboard":showToastAlert(a.message,{backgroundColor:"red"})}catch(t){console.error("AJAX Error:",t),showToastAlert("An error occurred during login. Please try again.",{backgroundColor:"red"})}}),$("#user-registeration-form").on("submit",async function(t){t.preventDefault();t=new FormData(this);t.append("name","user_register");try{var e=await $.ajax({type:"POST",url:base_url,data:t,processData:!1,contentType:!1,dataType:"json"});"success"===e.status?(showToastAlert("Registration successful! Please Login to Continue"),window.location.href="login"):showToastAlert(e.message,{backgroundColor:"red"})}catch(t){console.error("AJAX Error:",t),showToastAlert("An error occurred during registration. Please try again.",{backgroundColor:"red"})}}),$(".query").on("input",async function(){var t=$(this).val().trim(),e=$(".suggestions");if(t.length<0)e.empty().hide();else try{var a=await $.ajax({url:base_url,method:"GET",data:{query:t,name:"search_blog"},dataType:"json"});e.empty().show(),0===a.length?e.html('<li class="no-results text-muted">No blogs found</li>'):(e.html(a.map(suggestionTemplate).join("")),$(".suggestion-item").on("click",function(){$(".query").val($(this).text().trim()),$(".search-form").attr("data-id",$(this).attr("data-id")),e.html("").hide()}))}catch(t){console.error("Unexpected error:",t)}}),$("#search-form").on("submit",function(t){t.preventDefault(),disableButton(this);t=$(".search-form").attr("data-id");t?($(".query").val(""),window.location.href="single-blog?id="+t):showToastAlert("No Blog Found!"),enableButton(this)}),$(document).on("click",t=>{$(t.target).closest("#query, .suggestions").length||$(".suggestions").hide()}),$(".blog-list").on("click",".edit-btn",async function(){var e=$(this).attr("data-id");$("#edit-id").val(e),disableButton(this);try{let t=await $.ajax({url:relative_url,method:"GET",data:{id:e,name:"get_single_blog"},dataType:"json"});$(".edit-blog-data").each(function(){$(this).val(t[$(this).attr("name")])}),tinymce.get("content")&&tinymce.get("content").setContent(t.content),$(".edit-blog-content").addClass("active")}catch(t){console.error("Error fetching blog for edit:",t),showToastAlert("Failed to load blog data.",{backgroundColor:"red"})}}),$("#edit-blog-form").on("submit",async function(t){t.preventDefault(),tinymce.triggerSave();t=Object.fromEntries(new FormData(this));t.id=$("#edit-id").val(),disableButton(".edit-blog-btn");try{"success"===(await $.ajax({url:relative_url,method:"PATCH",contentType:"application/json",data:JSON.stringify(t)})).status&&(showToastAlert("Blog updated successfully!"),$(".edit-blog-content").removeClass("active"),loadBlogsForDashboard(),enableButton(".edit-btn"))}catch(t){console.error("Error updating blog:",t),showToastAlert("Failed to update blog.",{backgroundColor:"red"})}}),$(".close-edit").on("click",()=>{$(".edit-blog-content").removeClass("active"),enableButton(".edit-btn")});